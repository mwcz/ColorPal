<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>html5 local file upload demo</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v10">
<meta name="syntax" content="html">
<meta name="settings" content="use_css,pre_wrap,expand_tabs">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #d7d7d7; background-color: #1c1c1c; }
body { font-family: monospace; color: #d7d7d7; background-color: #1c1c1c; }

#colorpal_canvas { 
    border: 3px dotted #888;
    width: 400px;
    height: 300px;
    margin: 0 20px;
}

#colorpal_canvas
{
    -webkit-transition: all 0.33s ease-in; /* Safari and Chrome */
       -moz-transition: all 0.33s ease-in; /* Firefox 4 */
         -o-transition: all 0.33s ease-in; /* Opera */
            transition: all 0.33s ease-in;
}

#swatches { line-height: 0; }

.swatch {
    display: block;
    float: left;
    width: 30px;
    height: 30px;
}
-->
</style>

<script type="text/javascript" src="median-cut.js"> </script>
<script type="text/javascript" src="imagedata_to_rgb.js"> </script>
<script type="text/javascript">

var ctx, canvas, mc;

function handle_file_select( evt ) {
    var files = evt.target.files; // FileList object

    // Loop through the FileList and render image files as thumbnails.
    for ( var i = 0, f; f = files[i]; i++ ) {

        // Only process image files.
        if (!f.type.match('image.*')) {
            continue;
        }

        var reader = new FileReader();
        var img    = document.createElement("img");

        img.onload = function() {

            // Resize the canvas to the image size
            canvas.width             = img.width;
            canvas.height            = img.height;

            // Resize the canvas with CSS to trigger CSS3 transitions
            canvas.style.width       = img.width + "px";
            canvas.style.height      = img.height + "px";
            canvas.style.borderStyle = "solid";

            // Draw the image inside the canvas
            ctx.drawImage(img, 0, 0, img.width, img.height);

            var data = ctx.getImageData( 0, 0, img.width, img.height );
            var rgbdata = imagedata_to_rgb( data );
            mc = MedianCut();
            mc.init( rgbdata );
            var palette = mc.get_fixed_size_palette(16);

            for( var ic = palette.length - 1; ic >= 0; ic-- ) {
                var color = palette[ic];
                document.getElementById( "swatch" + ic ).style.backgroundColor = "rgb(" + parseInt(color[0]) + "," + parseInt(color[1]) + "," + parseInt(color[2]) + ")";
                console.log( ic, color );
                //console.log( document.getElementById( "swatch" + ic ).style.backgroundColor );
            }


        };

        // Read in the image file as a data URL.
        reader.readAsDataURL(f);

        reader.onload = function(e) {

            // Assign the image's src to the filesystem image's data URL [http://en.wikipedia.org/wiki/Data_URI_scheme]
            img.src = e.target.result; 

        };
    }
}

window.onload = function() {
    document.getElementById("colorpal_input_image").onchange = handle_file_select;
    canvas = document.getElementById("colorpal_canvas");
    ctx = canvas.getContext("2d");
};



</script>

</head>
<body>
<pre>

<h1>HTML5 local file upload demo</h1>

<p>choose an image from your local filesystem.  it will be drawn in a canvas element below.</p>

<input type="file" id="colorpal_input_image"></input>

<div id="list"></div>


<div id="swatches">

    <span id="swatch0" class="swatch"></span>
    <span id="swatch1" class="swatch"></span>
    <span id="swatch2" class="swatch"></span>
    <span id="swatch3" class="swatch"></span>
    <span id="swatch4" class="swatch"></span>
    <span id="swatch5" class="swatch"></span>
    <span id="swatch6" class="swatch"></span>
    <span id="swatch7" class="swatch"></span>
    <span id="swatch8" class="swatch"></span>
    <span id="swatch9" class="swatch"></span>
    <span id="swatch10" class="swatch"></span>
    <span id="swatch11" class="swatch"></span>
    <span id="swatch12" class="swatch"></span>
    <span id="swatch13" class="swatch"></span>
    <span id="swatch14" class="swatch"></span>
    <span id="swatch15" class="swatch"></span>

</div>

<canvas id="colorpal_canvas"></canvas>

</pre>
</body>
</html>

